# üîê Auth API - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞
API endpoints –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ –æ—à–∏–±–∫–∏ `400 Bad Request` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö":
```
GET http://localhost:3000/api/auth/profile 400 (Bad Request)
POST http://localhost:3000/api/auth/login 400 (Bad Request)
```

–û—à–∏–±–∫–∞ –±—ã–ª–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: 
`The table 'public.users' does not exist in the current database.`

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã
- –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã - –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞–ª–∏
- –ò–∑—É—á–µ–Ω—ã –ª–æ–≥–∏ backend –∏ PostgreSQL
- –í—ã—è–≤–ª–µ–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞: –º–∏–≥—Ä–∞—Ü–∏–∏ Prisma –Ω–µ –±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –°–±—Ä–æ—Å —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker exec asya-postgres psql -U asya_user -d asya_db -c "DROP SCHEMA public CASCADE; CREATE SCHEMA public;"

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
docker exec asya-backend npx prisma migrate deploy

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
docker exec asya-backend npx prisma db seed
```

### 3. –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- `20250804200255_init` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
- `20250804201717_add_dementia_screening_and_emotional_assessment` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü
- `20250804202009_add_user_admin_field` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è admin
- `20250807202003_add_questionnaires` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç —Å–∫—Ä–∏–ø—Ç
–°–æ–∑–¥–∞–Ω `test-auth-api.js` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö auth endpoints:

```bash
cd backend
node test-auth-api.js
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
1. **Health Check** - `GET /api/health`
2. **Login** - `POST /api/auth/login` 
3. **Profile** - `GET /api/auth/profile` (—Å –≤–∞–ª–∏–¥–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º)
4. **Security** - `GET /api/auth/profile` (—Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º)

### –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–æ–≤
```
‚úÖ –£—Å–ø–µ—à–Ω–æ: 4
‚ùå –ù–µ—É–¥–∞—á–Ω–æ: 0
üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ! API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
```

## üìã –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- **TelegramID**: `123456789` - –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ (test_user1)
- **TelegramID**: `987654321` - –ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞ (test_user2) 
- **TelegramID**: `555666777` - –ü–µ—Ç—Ä –ò–≤–∞–Ω–æ–≤ (admin_user) [Admin]

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞
```bash
# Login
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"telegramId": "123456789"}'

# Profile (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ –æ—Ç–≤–µ—Ç–∞ login)
curl -X GET http://localhost:3000/api/auth/profile \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

## ‚ú® –°—Ç–∞—Ç—É—Å
- üü¢ **POST /api/auth/login** - –†–∞–±–æ—Ç–∞–µ—Ç (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 201)
- üü¢ **GET /api/auth/profile** - –†–∞–±–æ—Ç–∞–µ—Ç (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200)
- üü¢ **POST /api/auth/telegram** - –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
- üü¢ **POST /api/auth/refresh** - –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
- üü¢ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã, seed –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–•–æ—Å—Ç**: postgres:5432 (–≤–Ω—É—Ç—Ä–∏ Docker)
- **–ë–∞–∑–∞**: asya_db
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: asya_user
- **–°—Ö–µ–º–∞**: public

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `tests` - —Ç–∏–ø—ã —Ç–µ—Å—Ç–æ–≤  
- `test_results` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
- `consultations` - –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
- `practices` - –ø—Ä–∞–∫—Ç–∏–∫–∏
- `dementia_screenings` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- `emotional_assessments` - —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏
- `questionnaires` - –∞–Ω–∫–µ—Ç—ã –æ—Ç –±–æ—Ç–∞

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω. –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É:

1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Mini App
2. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö endpoints
3. –£–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

Frontend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å —Å–º–æ–∂–µ—Ç —É—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤—ã–≤–∞—Ç—å—Å—è –∏ –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
